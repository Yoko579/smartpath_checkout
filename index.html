<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Concierge</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-size: cover;
      background-position: center;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 30px;
      max-width: 500px;
      width: 100%;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .top-bar img {
      height: 40px;
    }

    .language-switcher select {
      border-radius: 20px;
      padding: 5px;
      font-size: 14px;
    }

    h1 {
      font-size: 22px;
      color: #2c3e50;
    }

    p {
      font-size: 16px;
      color: #333;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 10px;
    }

    input[type="date"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 20px;
    }

    .checkbox {
      margin-bottom: 20px;
    }

    button {
      background-color: #25D366;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
    }

    button:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
    }

    .footer {
      margin-top: 20px;
      font-size: 12px;
      color: #888;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container" id="main">
    <div class="top-bar">
      <img id="hotelLogo" src="" alt="Hotel Logo">
      <div class="language-switcher">
        <select id="languageSelect">
          <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
          <option value="en">ðŸ‡¬ðŸ‡§ English</option>
          <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
          <option value="ar">ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        </select>
      </div>
    </div>

    <h1 id="title"></h1>
    <p id="welcomeText"></p>

    <label for="checkout" id="checkoutLabel"></label>
    <input type="date" id="checkout" name="checkout">

    <div class="checkbox">
      <label id="consentLabel">
        <input type="checkbox" id="consentCheckbox">
      </label>
    </div>

    <button id="continueBtn" disabled></button>

    <div class="footer" id="footerText"></div>
  </div>

  <script>
    // Translation texts for each supported language
    const translations = {
      fr: {
        title: (hotelName) => `Bienvenue Ã  ${hotelName}`,
        welcomeText: "Nous sommes ravis de vous accueillir. Pour amÃ©liorer votre expÃ©rience, notre concierge virtuel est disponible sur WhatsApp.",
        checkoutLabel: "Souhaitez-vous renseigner votre date de dÃ©part ?",
        consentText: (hotelName) => `J'accepte de recevoir des messages de l'hÃ´tel ${hotelName} via WhatsApp, y compris aprÃ¨s mon sÃ©jour pour donner mon avis.`,
        continueBtn: "Je donne mon accord et continue sur WhatsApp",
        footer: "ConformÃ©ment Ã  la politique WhatsApp Business, vous pouvez retirer votre consentement Ã  tout moment.",
        messageWithDate: (date) => `Bonjour, je souhaite utiliser le concierge IA. Ma date de dÃ©part est le ${date}.`,
        messageWithoutDate: "Bonjour, je souhaite utiliser le concierge IA."
      },
      en: {
        title: (hotelName) => `Welcome to ${hotelName}`,
        welcomeText: "We are pleased to welcome you. To enhance your stay, our virtual concierge is available on WhatsApp.",
        checkoutLabel: "Would you like to enter your checkout date?",
        consentText: (hotelName) => `I agree to receive messages from ${hotelName} via WhatsApp, including after my stay to provide feedback.`,
        continueBtn: "I agree and continue on WhatsApp",
        footer: "According to WhatsApp Business Policy, you may withdraw your consent at any time.",
        messageWithDate: (date) => `Hello, I would like to use the AI concierge. My checkout date is ${date}.`,
        messageWithoutDate: "Hello, I would like to use the AI concierge."
      },
      es: {
        title: (hotelName) => `Bienvenido al hotel ${hotelName}`,
        welcomeText: "Nos complace darle la bienvenida. Para mejorar su experiencia, nuestro conserje virtual estÃ¡ disponible en WhatsApp.",
        checkoutLabel: "Â¿Desea ingresar su fecha de salida?",
        consentText: (hotelName) => `Acepto recibir mensajes del hotel ${hotelName} por WhatsApp, incluso despuÃ©s de mi estancia para dejar una opiniÃ³n.`,
        continueBtn: "Doy mi consentimiento y continÃºo en WhatsApp",
        footer: "SegÃºn la polÃ­tica de WhatsApp Business, puede retirar su consentimiento en cualquier momento.",
        messageWithDate: (date) => `Hola, me gustarÃ­a utilizar el conserje virtual. Mi fecha de salida es ${date}.`,
        messageWithoutDate: "Hola, me gustarÃ­a utilizar el conserje virtual."
      },
      ar: {
        title: (hotelName) => `Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨ÙƒÙ… ÙÙŠ ÙÙ†Ø¯Ù‚ ${hotelName}`,
        welcomeText: "ÙŠØ³Ø¹Ø¯Ù†Ø§ Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø¨ÙƒÙ…. Ù„ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨ØªÙƒÙ…ØŒ ÙŠØªÙˆÙØ± Ù„Ø¯ÙŠÙ†Ø§ Ø¨ÙˆØ§Ø¨ Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨.",
        checkoutLabel: "Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©ØŸ",
        consentText: (hotelName) => `Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ ØªÙ„Ù‚ÙŠ Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† ÙÙ†Ø¯Ù‚ ${hotelName} Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ØŒ Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø¨Ø¹Ø¯ Ø¥Ù‚Ø§Ù…ØªÙŠ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø±Ø£ÙŠÙŠ.`,
        continueBtn: "Ø£ÙˆØ§ÙÙ‚ ÙˆØ£ØªØ§Ø¨Ø¹ Ø¥Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨",
        footer: "ÙˆÙÙ‚Ù‹Ø§ Ù„Ø³ÙŠØ§Ø³Ø© ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø£Ø¹Ù…Ø§Ù„ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ø­Ø¨ Ù…ÙˆØ§ÙÙ‚ØªÙƒ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª.",
        messageWithDate: (date) => `Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø£Ø±ØºØ¨ ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø°ÙƒÙŠ. ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø© Ù‡Ùˆ ${date}.`,
        messageWithoutDate: "Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø£Ø±ØºØ¨ ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø°ÙƒÙŠ."
      }
    };

    // Elements
    const languageSelect = document.getElementById('languageSelect');
    const checkoutInput = document.getElementById('checkout');
    const continueBtn = document.getElementById('continueBtn');
    let currentLang = 'en';
    let hotelData = null;

    // Load hotel data and handle language + content setup
    window.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const hotelKey = params.get('hotel'); // Key used in hotels.json (ex: azur, sahara)

      fetch('hotels.json')
        .then(res => res.json())
        .then(data => {
          if (!hotelKey || !data[hotelKey]) throw new Error("Hotel not found");
          hotelData = data[hotelKey]; // Extract full hotel object

          // Load hotel logo
          document.getElementById('hotelLogo').src = hotelData.logo;

          // Detect browser language
          const browserLang = navigator.language.slice(0, 2);
          const supportedLangs = ['fr', 'en', 'es', 'ar'];
          const langToUse = supportedLangs.includes(browserLang) ? browserLang : 'en';
          setLanguage(langToUse);
        })
        .catch(err => {
          console.error(err);
          alert("Error: Hotel not found.");
        });

      // Generate temporary guest code
      function generateTempCode(length = 8) {
        const characters = 'abcdefghijklmnopqrstuvwxyz0123456789';
        let result = '';
        for (let i = 0; i < length; i++) {
          result += characters[Math.floor(Math.random() * characters.length)];
        }
        return result;
      }

      // Enable/disable button based on consent checkbox
      document.getElementById('main').addEventListener('change', () => {
        const checkbox = document.getElementById('consentCheckbox');
        continueBtn.disabled = !checkbox.checked;
      });
    });

    // Set UI language dynamically
    function setLanguage(lang) {
      if (!translations[lang]) lang = 'en';
      currentLang = lang;

      document.documentElement.lang = lang;
      document.body.style.direction = lang === 'ar' ? 'rtl' : 'ltr';
      languageSelect.value = lang;

      const t = translations[lang];
      const hotelName = hotelData?.name || '';

      document.getElementById('title').innerText = t.title(hotelName);
      document.getElementById('welcomeText').innerText = t.welcomeText;
      document.getElementById('checkoutLabel').innerText = t.checkoutLabel;
      document.getElementById('consentLabel').innerHTML = `<input type="checkbox" id="consentCheckbox"> ${t.consentText(hotelName)}`;
      document.getElementById('footerText').innerText = t.footer;
      continueBtn.innerText = t.continueBtn;
    }

    // Handle WhatsApp redirection after sending data to Make webhook
    continueBtn.addEventListener('click', () => {
      const checkoutDate = checkoutInput.value || null;
      const hotelName = hotelData.name;
      const hotelAirtableId = hotelData.id;
      const tempCode = generateTempCode();

      const payload = {
        hotelName: hotelName,
        hotelId: hotelAirtableId,
        checkoutDate: checkoutDate,
        language: currentLang,
        code: tempCode
      };

      fetch("https://hook.us1.make.com/abc123xyz456", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      })
      .then(res => {
        const message = `Bonjour, mon code est : ${tempCode}`;
        const encodedMessage = encodeURIComponent(message);
        const whatsappLink = `https://wa.me/212653421433?text=${encodedMessage}`;

        setTimeout(() => {
          window.location.href = whatsappLink;
        }, 1000);
      })
      .catch(err => {
        console.error(err);
        alert("An error occurred. Please try again.");
      });
    });

    // Language change listener
    languageSelect.addEventListener('change', (e) => {
      setLanguage(e.target.value);
    });
  </script>
</body>
</html>
